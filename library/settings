#!/data/data/com.termux/files/usr/bin/bash
#
# Installation Webserver
#
# @author Ayus Irfang Filaras <ayus.sahabat@gmail.com
# @lisence GPL
#
source library/func

lamppScript()
{
    progress "Proses install lampp script" 10
    
    cp lampp-script /data/data/com.termux/files/usr/bin/lampp
    
    echo -e "\e[32;mBerhasil menginstall lampp script.\e[0m\n"
    bash lampp --help
    
    exit 1
}

# Mengatur symbolic direktori
__ln()
{
    while true;
    do
        formSourceLN
    done
}

formSourceLN()
{
    echo -e "\n\e[32;m>\e[0m Masukan direktori source contoh: ~/storage/shared/www"
    read -p "Source folder: " source
    
    progress "[Checking]" 10
    
    formCheckSourceLN
}

formCheckSourceLN()
{
    if [ ! -z ${source} ]; then
        # Cek apakah direktori source ada
        if ! [ -d ${source} ]; then
            formSymbolic ${source}
        else
            echo -e "\e[31;mDirektori ${source} tidak dapat ditemukan.\e[0m"
        fi
    else
        echo -e "\e[31;mMaaf, Anda tidak memasukkan direktori source.\e[0m"
    fi
}

formSymbolic()
{
    echo -e "\e[32;m>\e[0m Masukan direktori symbolic link contoh: /data/data/com.termux/files/usr/var"
    read -p "Symbolic folder: " target
    
    progress "[Checking]" 10
    
    formCheckSymbolic ${1} ${2}
}

formCheckSymbolic()
{
    # Cek symbolic jika sudah ada
    if ! [ -h ${2}/www ]; then
        echo -e "\e[31;mSymbolic link sudah ada.\e[0m"
        
        lamppScript
    else
        proot ln -s ${1} $}2}
        echo -e "\e[32;mBerhasil membuat symnolic link.\e[0m"
        lamppScript
    fi
}

case ${1} in
    "--ln")
        __ln
        ;;
    "--ls")
        lamppScript
        ;;
esac
